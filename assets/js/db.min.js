"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var WP_DOUBAN=function(){function e(){_classCallCheck(this,e),this.ver="1.0.1",this.type="movie",this.finished=!1,this.paged=1,this.genre_list=[],this.genre=[],this.subjects=[],this._create()}return _createClass(e,[{key:"on",value:function(e,t,r){document.querySelectorAll(t).forEach(function(t){t.addEventListener(e,r)})}},{key:"_fetchGenres",value:function(){var e=this;fetch(wpd_base.api+"v1/movie/genres").then(function(e){return e.json()}).then(function(t){t.length&&(e.genre_list=t,e._renderGenre())})}},{key:"_handleGenreClick",value:function(){var e=this;this.on("click",".db--genreItem",function(t){var r=t.target;if(r.classList.contains("is-active")){var n=e.genre.indexOf(r.innerText);return r.classList.remove("is-active"),e.genre.splice(n,1),e.paged=1,e.finished=!1,e.subjects=[],void e._fetchData()}document.querySelector(".db--list").innerHTML="",document.querySelector(".lds-ripple").classList.remove("u-hide"),r.classList.add("is-active"),e.genre.push(r.innerText),e.paged=1,e.finished=!1,e.subjects=[],e._fetchData()})}},{key:"_renderGenre",value:function(){var e=this;document.querySelector(".db--genres").innerHTML=this.genre_list.map(function(t){return'<span class="db--genreItem'.concat(e.genre_list.includes(t.name)?" is-active":"",'">').concat(t.name,"</span>")}).join(""),this._handleGenreClick()}},{key:"_fetchData",value:function(){var e=this;fetch(wpd_base.api+"v1/movies?type="+this.type+"&paged="+this.paged+"&genre="+JSON.stringify(this.genre)).then(function(e){return e.json()}).then(function(t){t.length?(document.querySelector(".db--list").classList.contains("db--list__card")?(e.subjects=[].concat(_toConsumableArray(e.subjects),_toConsumableArray(t)),e._randerDateTemplate()):(e.subjects=[].concat(_toConsumableArray(e.subjects),_toConsumableArray(t)),e._randerListTemplate()),document.querySelector(".lds-ripple").classList.add("u-hide")):(e.finished=!0,document.querySelector(".lds-ripple").classList.add("u-hide"))})}},{key:"_randerDateTemplate",value:function(){var e=this.subjects.reduce(function(e,t){var r=new Date(t.create_time),n=r.getFullYear(),a=r.getMonth()+1,i="".concat(n,"-").concat(a.toString().padStart(2,"0"));return Object.prototype.hasOwnProperty.call(e,i)?e[i].push(t):e[i]=[t],e},{}),t="";for(var r in e){var n=r.split("-");t+='<div class="db--listBydate"><div class="db--titleDate JiEun"><div class="db--titleDate__day">'.concat(n[1],'</div><div class="db--titleDate__month">').concat(n[0],'</div></div><div class="db--dateList__card">'),t+=e[r].map(function(e){return'<div class="db--item">'.concat(e.is_top250?'<span class="top250">Top 250</span>':"",'<img src="').concat(e.poster,'" referrerpolicy="no-referrer" class="db--image"><div class="db--score JiEun">').concat(e.douban_score>0?'<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" ><path d="M12 20.1l5.82 3.682c1.066.675 2.37-.322 2.09-1.584l-1.543-6.926 5.146-4.667c.94-.85.435-2.465-.799-2.567l-6.773-.602L13.29.89a1.38 1.38 0 0 0-2.581 0l-2.65 6.53-6.774.602C.052 8.126-.453 9.74.486 10.59l5.147 4.666-1.542 6.926c-.28 1.262 1.023 2.26 2.09 1.585L12 20.099z"></path></svg>'+e.douban_score:"").concat(e.year>0?" · "+e.year:"",'</div><div class="db--title"><a href="').concat(e.link,'" target="_blank">').concat(e.name,"</a></div>\n    \n    </div>")}).join(""),t+="</div></div>"}document.querySelector(".db--list").innerHTML=t}},{key:"_randerListTemplate",value:function(){document.querySelector(".db--list").innerHTML=this.subjects.map(function(e){return'<div class="db--item">'.concat(e.is_top250?'<span class="top250">Top 250</span>':"",'<img src="').concat(e.poster,'" referrerpolicy="no-referrer" class="db--image"><div class="ipc-signpost JiEun">').concat(e.create_time,'</div><div class="db--score JiEun">').concat(e.douban_score>0?'<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" ><path d="M12 20.1l5.82 3.682c1.066.675 2.37-.322 2.09-1.584l-1.543-6.926 5.146-4.667c.94-.85.435-2.465-.799-2.567l-6.773-.602L13.29.89a1.38 1.38 0 0 0-2.581 0l-2.65 6.53-6.774.602C.052 8.126-.453 9.74.486 10.59l5.147 4.666-1.542 6.926c-.28 1.262 1.023 2.26 2.09 1.585L12 20.099z"></path></svg>'+e.douban_score:"").concat(e.year>0?" · "+e.year:"",'</div><div class="db--title"><a href="').concat(e.link,'" target="_blank">').concat(e.name,"</a></div>\n                </div>\n                </div>")}).join("")}},{key:"_handleScroll",value:function(){var e=this;window.addEventListener("scroll",function(){var t=window.scrollY||window.pageYOffset;document.querySelector(".block-more").offsetTop+-window.innerHeight<t&&document.querySelector(".lds-ripple").classList.contains("u-hide")&&!e.finished&&(document.querySelector(".lds-ripple").classList.remove("u-hide"),e.paged++,e._fetchData())})}},{key:"_handleNavClick",value:function(){var e=this;this.on("click",".db--navItem",function(t){t.target.classList.contains("current")||(e.genre=[],e.type=t.target.dataset.type,"movie"==e.type?(document.querySelector(".db--genres").classList.remove("u-hide"),e._renderGenre()):document.querySelector(".db--genres").classList.add("u-hide"),document.querySelector(".db--list").innerHTML="",document.querySelector(".lds-ripple").classList.remove("u-hide"),document.querySelector(".db--navItem.current").classList.remove("current"),t.target.classList.add("current"),e.paged=1,e.finished=!1,e.subjects=[],e._fetchData())})}},{key:"_create",value:function(){var e=this;document.querySelector(".db--container")&&(document.querySelector(".db--navItem.current")&&(this.type=document.querySelector(".db--navItem.current").dataset.type),document.querySelector(".db--list").dataset.type&&(this.type=document.querySelector(".db--list").dataset.type),"movie"==this.type&&document.querySelector(".db--genres").classList.remove("u-hide"),this._fetchGenres(),this._fetchData(),this._handleScroll(),this._handleNavClick()),document.querySelector(".db--collection")&&document.querySelectorAll(".db--collection").forEach(function(t){e._fetchCollection(t)})}},{key:"_fetchCollection",value:function(e){var t=e.dataset.style?e.dataset.style:"card";fetch(wpd_base.api+"v1/movies?type="+e.dataset.type+"&paged=1&genre=&start_time="+e.dataset.start+"&end_time="+e.dataset.end).then(function(e){return e.json()}).then(function(r){if(r.length)if("card"==t)e.innerHTML+=r.map(function(e){return'<div class="doulist-item">\n                            <div class="doulist-subject">\n                            <div class="db--viewTime JiEun">Marked '.concat(e.create_time,'</div>\n                            <div class="doulist-post"><img referrerpolicy="no-referrer" src="').concat(e.poster,'"></div><div class="doulist-content"><div class="doulist-title"><a href="').concat(e.link,'" class="cute" target="_blank" rel="external nofollow">').concat(e.name,'</a></div><div class="rating"><span class="allstardark"><span class="allstarlight" style="width:75%"></span></span><span class="rating_nums">').concat(e.douban_score,'</span></div><div class="abstract">').concat(e.remark||e.card_subtitle,"</div></div></div></div>")}).join("");else{var n=r.reduce(function(e,t){return Object.prototype.hasOwnProperty.call(e,t.create_time)?e[t.create_time].push(t):e[t.create_time]=[t],e},{}),a="";for(var i in n)a+='<div class="db--date">'.concat(i,'</div><div class="db--dateList">'),a+=n[i].map(function(e){return'<div class="db--card__list"">\n                                    <img referrerpolicy="no-referrer" src="'.concat(e.poster,'">\n                                    <div>\n                                    <div class="title"><a href="').concat(e.link,'" class="cute" target="_blank" rel="external nofollow">').concat(e.name,'</a></div>\n                                    <div class="rating"><span class="allstardark"><span class="allstarlight" style="width:75%"></span></span><span class="rating_nums">').concat(e.douban_score,"</span></div>\n                                    ").concat(e.remark||e.card_subtitle,"\n                                    </div>\n                                    </div>")}).join(""),a+="</div>";e.innerHTML=a}})}}]),e}();new WP_DOUBAN;
